<apex:component controller="SearchObjectSetting" allowDML="true">
    <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <apex:slds />
        <meta http-equiv="x-ua-compatible" content="ie=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="{!URLFOR($Resource.jQuery351)}"></script>
        <script src="/soap/ajax/44.0/connection.js" type="text/javascript"></script>
        <script src="/soap/ajax/43.0/apex.js" type="text/javascript"></script>
        <script src="{!URLFOR($Resource.aljs)}"></script>
        <style>
            .clsdelete {
            cursor: default;
            }
            
            .validation {
            margin-bottom: 20px;
            }
        </style>
        
        <body>
            
            
            
            <div class="slds-scope slds-m-horizontal_small">
                
                <div class="slds-page-header">
                    <div class="slds-media">
                        <div class="slds-media__figure">
                            <span class="slds-icon_container slds-icon-standard-search slds-icon_container--circle" title="Configuration">
                                <svg class="slds-icon slds-icon--small" aria-hidden="true">
                                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/custom-sprite/svg/symbols.svg#custom108")}" />
                                </svg>
                            </span>
                        </div>
                        <div class="slds-media__body">
                            <h1 class="slds-page-header__title slds-truncate " title="Configuration">Configuration</h1>
                            <p class="slds-text-body_small slds-line-height_reset">Settings</p>
                        </div>
                    </div>
                </div>
                
                <div class=" slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_success " style="display:none;" role="alert" id="lblmsg"></div>
                
                <div class="slds-tabs_default">
                    <div id="tab-default-1" class="slds-tabs_default__content slds-show" role="tabpanel" aria-labelledby="tab-default-1__item">
                        <div class="slds-tabs_scoped">
                            <ul class="slds-tabs_scoped__nav" role="tablist">
                                <li class="slds-tabs_scoped__item slds-is-active" title="Select Default Objects to Search" role="presentation">
                                    <a class="slds-tabs_scoped__link" href="javascript:void(0);" role="tab" tabindex="0" aria-selected="true" aria-controls="tab-scoped-1"
                                       id="tab-scoped-1__item">Select Default Objects to Search</a>
                                </li>
                                <li class="slds-tabs_scoped__item" title="General" role="presentation">
                                    <a class="slds-tabs_scoped__link" href="javascript:void(0);" role="tab" tabindex="-1" aria-selected="false" aria-controls="tab-scoped-2"
                                       id="tab-scoped-2__item">General</a>
                                </li>
                                <li class="slds-tabs_scoped__item" title="FAQs" role="presentation">
                                    <a class="slds-tabs_scoped__link" href="javascript:void(0);" role="tab" tabindex="-1" aria-selected="false" aria-controls="tab-scoped-3"
                                       id="tab-scoped-3__item">FAQs</a>
                                </li>
                                <li class="slds-tabs_scoped__item" title="Track Deleted Records" role="presentation" onclick="gettrackingobjects()">
                                    <a class="slds-tabs_scoped__link" href="javascript:void(0);" role="tab" tabindex="-1" aria-selected="false" aria-controls="tab-scoped-4"
                                       id="tab-scoped-4__item">Track Deleted Records</a>
                                </li>
                                <li class="slds-tabs_scoped__item" title="Track Permanently Deleted Data" role="presentation" onclick="getpermtrackingobjects()">
                                    <a class="slds-tabs_scoped__link" href="javascript:void(0);" role="tab" tabindex="-1" aria-selected="false" aria-controls="tab-scoped-5"
                                       id="tab-scoped-5__item">Track Permanently Deleted Data</a>
                                </li>
                            </ul>
                            <div id="tab-scoped-1" class="slds-tabs_scoped__content slds-show" role="tabpanel" aria-labelledby="tab-scoped-1__item">
                                
                                <div class="slds-box">
                                    <p>
                                        <i>
                                            <b>Note:</b>
                                        </i> Please add the objects you would like to search by default when using the recycle bin
                                        manager app. Upto 20 objects can be selected on this page.</p>
                                </div>
                                
                                
                                <table class="slds-table slds-table_bordered slds-max-medium-table_stacked-horizontal slds-m-top_small sldstbodysection">
                                    <thead>
                                        <tr class="slds-line-height_reset">
                                            <th class="slds-text-title_caps slds-cell-wrap slds-size_1-of-12" scope="col">
                                                <div class="slds-truncate" title="Action">Action</div>
                                            </th>
                                            <th class="slds-text-title_caps slds-cell-wrap slds-size_11-of-12" scope="col">
                                                <div class="slds-truncate" title="Object Name">Object Name</div>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbodysection">
                                        
                                    </tbody>
                                    <tfoot>
                                        <tr class="slds-line-height_reset">
                                            <td class="slds-text-title_caps slds-cell-wrap" scope="col" colspan="2">
                                                
                                                <button class="slds-button slds-button_brand" id="btnAddnew">Add New</button>
                                                <div class=" slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_success slds-hide" role="alert" id="lblmsg"></div>
                                                <button class="slds-button slds-button_brand slds-hide" id="btnSave">Save</button>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                                
                            </div>
                            <div id="tab-scoped-2" class="slds-tabs_scoped__content slds-hide" role="tabpanel" aria-labelledby="tab-scoped-2__item">                                  
                                
                                <div class="slds-form slds-form_stacked">
                                    <apex:form >
                                        
                                        <div class="slds-hide">
                                            
                                            <apex:selectList multiselect="false" size="1" styleClass="slds-select ddlObject">
                                                <apex:selectOptions value="{!lstObjects}"></apex:selectOptions>
                                            </apex:selectList>
                                            <apex:selectList multiselect="false" size="1" styleClass="slds-select ddltrackingObject">
                                                <apex:selectOptions value="{!lsttrackingObjects}"></apex:selectOptions>
                                            </apex:selectList>
                                            
                                        </div>
                                        
                                        <div class="slds-grid slds-wrap custom-container">
                                            <div class="slds-form-element__control slds-size_1-of-2 slds-max-small-size_1-of-1">
                                                <div class="slds-checkbox">
                                                    <span for="checkbox-27"><label class="slds-form-element__label" for="checkbox-27"><b>Search Inactive Users in Deleted By</b> </label>&nbsp;&nbsp;</span><br/>
                                                    <input type="checkbox" name="default"
                                                           id="checkbox-27" value="checkbox-27" />
                                                    <label class="slds-checkbox__label" for="checkbox-27">
                                                        <span class="slds-checkbox_faux"></span>
                                                        <span class="slds-form-element__label"></span>
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <div class="slds-form-element slds-size_1-of-2 slds-max-small-size_1-of-1">
                                                <label class="slds-form-element__label" for="emailtext">
                                                    <abbr class="slds-required" title="required">* </abbr><b>Send record deletion email(s) to [comma separated (,) without space.]</b></label>
                                                <div class="slds-form-element__control">
                                                    <input type="text" id="emailtext" label="Send record deletion email to" placeholder="Email Id..." required="" class="slds-input" />
                                                </div>
                                            </div>
                                            
                                            <div class="slds-form-element slds-size_1-of-2 slds-max-small-size_1-of-1 slds-hide" id="trackingschedule"> 
                                                <div id="schedulebatch" class="slds-hide">
                                                    <div class="slds-grid slds-wrap custom-container">
                                                        <div class="slds-form-element slds-size_1-of-2 slds-max-small-size_1-of-1">
                                                            <fieldset class="slds-form-element">
                                                                <legend class="slds-form-element__legend slds-form-element__label">Frequency</legend>
                                                                <div class="slds-form-element__control">
                                                                    <span class="slds-radio">
                                                                        <input type="radio" id="dailytrack" value="true" name="dailyradio" onchange="selectweekfortracking()" />
                                                                        <label class="slds-radio__label" for="dailytrack">
                                                                            <span class="slds-radio_faux"></span>
                                                                            <span class="slds-form-element__label">Daily</span>
                                                                        </label>
                                                                    </span>
                                                                    <span class="slds-radio">
                                                                        <input type="radio" id="weeklytrack" value="true" name="dailyradio" onchange="selectweekfortracking()"/>
                                                                        <label class="slds-radio__label" for="weeklytrack">
                                                                            <span class="slds-radio_faux"></span>
                                                                            <span class="slds-form-element__label">Weekly</span>
                                                                        </label>
                                                                    </span>
                                                                </div>
                                                            </fieldset>
                                                        </div>
                                                        <div class="slds-form-element slds-size_1-of-2 slds-max-small-size_1-of-1">
                                                            <div id="selectweek" class="slds-hide">
                                                                
                                                                <fieldset class="slds-form-element">
                                                                    <legend class="slds-form-element__legend slds-form-element__label"><abbr class="slds-required" title="required">* </abbr>Recurs every week on</legend>
                                                                    <apex:repeat id="selectedweek" value="{!getweeklist}" var="opt">
                                                                        <div class="slds-form-element">
                                                                            <div class="slds-form-element__control">
                                                                                <div class="slds-checkbox">
                                                                                    <input type="checkbox" name="options" id="{!opt.value}" checked="" onclick="enableDisable({!opt.value})"/>
                                                                                    <label class="slds-checkbox__label" for="{!opt.value}">
                                                                                        <span class="slds-checkbox_faux"></span>
                                                                                        <span class="slds-form-element__label">{!opt.label}</span>
                                                                                    </label>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </apex:repeat>
                                                                </fieldset>
                                                                
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!--<div class="slds-form-element">
                                                        <label class="slds-form-element__label"><abbr class="slds-required" title="required">* </abbr><b>Start</b></label>
                                                        <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--right">
                                                            <svg aria-hidden="true" class="slds-input__icon slds-icon-text-default">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,"/assets/icons/utility-sprite/svg/symbols.svg#event")}"></use>
                                                            </svg>
                                                            <apex:inputText id="ipFromDate" styleClass="slds-input ldsdatepicker" />
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="slds-form-element">
                                                        <label class="slds-form-element__label"><abbr class="slds-required" title="required">* </abbr><b>End</b></label>
                                                        <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--right">
                                                            <svg aria-hidden="true" class="slds-input__icon slds-icon-text-default">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS,"/assets/icons/utility-sprite/svg/symbols.svg#event")}"></use>
                                                            </svg>
                                                            <apex:inputText id="ipToDate" styleClass="slds-input ldsdatepicker" />
                                                        </div>
                                                    </div>-->
                                                    
                                                    <label class="slds-form-element__label"><abbr class="slds-required" title="required">* </abbr><b>Preferred Start Time</b></label>
                                                    <div class="slds-form-element__control">
                                                        <apex:selectList id="preferredtime" multiselect="false" size="1" styleClass="slds-select">
                                                            <apex:selectOptions value="{!getpreferedtime}"></apex:selectOptions>
                                                        </apex:selectList>
                                                    </div>
                                                    
                                                </div>
                                            </div>
                                        </div>
                                    </apex:form>
                                    <div id="enabletracking" class="slds-form-element__control slds-size_1-of-2 slds-max-small-size_1-of-1">
                                        <div class="slds-checkbox">
                                            <span for="objtrackingchk"><label class="slds-form-element__label" for="objtrackingchk"><b>Enable Object Tracking</b> </label>&nbsp;&nbsp;</span><br/>
                                            <input type="checkbox" name="default"
                                                   id="objtrackingchk" value="objtrackingchk" />
                                            <label class="slds-checkbox__label" for="objtrackingchk">
                                                <span class="slds-checkbox_faux"></span>
                                                <span class="slds-form-element__label"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <!--<div class="slds-form-element slds-size_1-of-2 slds-max-small-size_1-of-1" id="remotesitesettbtn">
                                        <button id="remotesitesett" class="slds-button slds-button_brand">Create Remote Site Setting</button>
                                    </div>-->
                                    <div class="slds-align_absolute-center" style="height: 3rem;">
                                        <button id="btnSaveGeneral" class="slds-button slds-button_brand btnDisabled">Save</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="tab-scoped-3" class="slds-tabs_scoped__content slds-hide" role="tabpanel" aria-labelledby="tab-scoped-3__item">
                                <div class="slds-card">
                                    <ul class="slds-accordion">
                                        <li class="slds-accordion__list-item">
                                            <section class="slds-accordion__section slds-is-open">
                                                <div class="slds-accordion__summary">
                                                    <h3 class="slds-accordion__summary-heading">
                                                        <button class="slds-button slds-button_reset slds-accordion__summary-action" aria-expanded="true" aria-controls="accordion-details-01">
                                                            <svg class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/utility-sprite/svg/symbols.svg#switch")}" />
                                                            </svg>
                                                            <span title="How to use this app?" class="slds-truncate">How to use this app?</span>
                                                        </button>
                                                    </h3>
                                                </div>
                                                <div class="slds-accordion__content" id="accordion-details-01" aria-hidden="false">To use this app, you just need to know how to switch to the Recycle Bin App from
                                                    App Launcher in Salesforce…That’s it!</div>
                                            </section>
                                        </li>
                                        <li class="slds-accordion__list-item">
                                            <section class="slds-accordion__section">
                                                <div class="slds-accordion__summary">
                                                    <h3 class="slds-accordion__summary-heading">
                                                        <button class="slds-button slds-button_reset slds-accordion__summary-action" aria-expanded="false" aria-controls="accordion-details-02">
                                                            <svg class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/utility-sprite/svg/symbols.svg#switch")}" />
                                                            </svg>
                                                            <span title="Can we restore the records deleted before 15 days?" class="slds-truncate">Can we restore the records deleted before 15 days?</span>
                                                        </button>
                                                    </h3>
                                                </div>
                                                <div class="slds-accordion__content" id="accordion-details-02" aria-hidden="true">No, Deleted records remain in the recycle bin for
                                                    <a target="_blank" href="https://help.salesforce.com/articleView?id=home_delete.htm&type=5">15 days</a>, and can be restored during that time. We cannot restore the
                                                    permanently deleted records without contacting salesforce. </div>
                                            </section>
                                        </li>
                                        <li class="slds-accordion__list-item">
                                            <section class="slds-accordion__section">
                                                <div class="slds-accordion__summary">
                                                    <h3 class="slds-accordion__summary-heading">
                                                        <button class="slds-button slds-button_reset slds-accordion__summary-action" aria-expanded="false" aria-controls="accordion-details-03">
                                                            <svg class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/utility-sprite/svg/symbols.svg#switch")}" />
                                                            </svg>
                                                            <span title="Are there any features restricted only for the System Admin users?" class="slds-truncate">Are there any features restricted only for the System Admin users?</span>
                                                        </button>
                                                    </h3>
                                                    
                                                </div>
                                                <div class="slds-accordion__content" id="accordion-details-03" aria-hidden="true">Yes, Purge Selected Records (to permanently delete the records) button and the
                                                    Deleted by User filter in the search criteria are restricted to the system
                                                    admin users.</div>
                                            </section>
                                        </li>
                                        <li class="slds-accordion__list-item">
                                            <section class="slds-accordion__section">
                                                <div class="slds-accordion__summary">
                                                    <h3 class="slds-accordion__summary-heading">
                                                        <button class="slds-button slds-button_reset slds-accordion__summary-action" aria-expanded="false" aria-controls="accordion-details-04">
                                                            <svg class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/utility-sprite/svg/symbols.svg#switch")}" />
                                                            </svg>
                                                            <span title="Do I need to select an object before I can search for the deleted records?" class="slds-truncate">Do I need to select an object before I can search for the deleted
                                                                records?</span>
                                                        </button>
                                                    </h3>
                                                    
                                                </div>
                                                <div class="slds-accordion__content" id="accordion-details-04" aria-hidden="true">No, the App will search the deleted Account, Contact and Lead by default. You
                                                    can include or remove the default objects to be searched from the Settings
                                                    Tab.
                                                    <i>(
                                                        <b>Note:</b> Upto 20 objects can be selected)</i>
                                                </div>
                                            </section>
                                        </li>
                                        <li class="slds-accordion__list-item">
                                            <section class="slds-accordion__section">
                                                <div class="slds-accordion__summary">
                                                    <h3 class="slds-accordion__summary-heading">
                                                        <button class="slds-button slds-button_reset slds-accordion__summary-action" aria-expanded="false" aria-controls="accordion-details-05">
                                                            <svg class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/utility-sprite/svg/symbols.svg#switch")}" />
                                                            </svg>
                                                            <span title="Can I preview the deleted record before restoring it from the recycle bin?" class="slds-truncate">Can I preview the deleted record before restoring it from the recycle
                                                                bin?</span>
                                                        </button>
                                                    </h3>
                                                    
                                                </div>
                                                <div class="slds-accordion__content" id="accordion-details-05" aria-hidden="true">Yes, you can view the data of deleted records by clicking on the record name
                                                    before restoring the record, it will open a new tab to display the data in
                                                    read only format.</div>
                                            </section>
                                        </li>
                                        
                                        <li class="slds-accordion__list-item">
                                            <section class="slds-accordion__section">
                                                <div class="slds-accordion__summary">
                                                    <h3 class="slds-accordion__summary-heading">
                                                        <button class="slds-button slds-button_reset slds-accordion__summary-action" aria-expanded="false" aria-controls="accordion-details-05">
                                                            <svg class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/utility-sprite/svg/symbols.svg#switch")}" />
                                                            </svg>
                                                            <span title="Can I preview the deleted record before restoring it from the recycle bin?" class="slds-truncate">Why Reports and Dashboards objects are not supported in this app?</span>
                                                        </button>
                                                    </h3>
                                                    
                                                </div>
                                                <div class="slds-accordion__content" id="accordion-details-05" aria-hidden="true">We didn’t include the reports and dashboards to restore or view because Salesforce
                                                    doesn’t provide programmatic access to restore Reports/Dashboards/Folders
                                                    like it does for other standard objects such as Accounts, Contacts, etc.
                                                    and custom objects. They are essentially considered as metadata and hence
                                                    devoid of option to restore via code. We are not supporting the metadata
                                                    restore feature as of now.</div>
                                            </section>
                                        </li>
                                        
                                        <li class="slds-accordion__list-item">
                                            <section class="slds-accordion__section">
                                                <div class="slds-accordion__summary">
                                                    <h3 class="slds-accordion__summary-heading">
                                                        <button class="slds-button slds-button_reset slds-accordion__summary-action" aria-expanded="false" aria-controls="accordion-details-05">
                                                            <svg class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/utility-sprite/svg/symbols.svg#switch")}" />
                                                            </svg>
                                                            <span title="Can I preview the deleted record before restoring it from the recycle bin?" class="slds-truncate">What are the common warning/error messages that I may encounter while
                                                                using this app?</span>
                                                        </button>
                                                    </h3>
                                                    
                                                </div>
                                                <div class="slds-accordion__content" id="accordion-details-05" aria-hidden="true"> 1. selected record(s) are in process of getting purged. : This message indicates
                                                    that the record you are trying to restore has been permanently deleted using
                                                    the purge functionality. Salesforce runs a process on a scheduled basis that
                                                    physically deletes records that have been purged from the recycle bin, if
                                                    that process has not run yet, you will see the records in the recycle bin.
                                                    <br/> 2. Deleted From Date cannot be greater than Deleted To Date. : The deleted
                                                    from date should be earlier than the deleted to date.</div>
                                            </section>
                                        </li>
                                        <li class="slds-accordion__list-item">
                                            <section class="slds-accordion__section">
                                                <div class="slds-accordion__summary">
                                                    <h3 class="slds-accordion__summary-heading">
                                                        <button class="slds-button slds-button_reset slds-accordion__summary-action" aria-expanded="false" aria-controls="accordion-details-05">
                                                            <svg class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/utility-sprite/svg/symbols.svg#switch")}" />
                                                            </svg>
                                                            <span title="Can I preview the deleted record before restoring it from the recycle bin?" class="slds-truncate">Is it possible to keep track of the deleted records?</span>
                                                        </button>
                                                    </h3>
                                                    
                                                </div>
                                                <div class="slds-accordion__content" id="accordion-details-05" aria-hidden="true">Yes, you can configure list of objects you would like to keep track for deletion from the “Track Deleted Records” tab under the settings. Once you select any object in this tab an email will be sent to the notification email address every time a record from that object is deleted.
                                                </div>
                                            </section>
                                        </li>
                                        <li class="slds-accordion__list-item">
                                            <section class="slds-accordion__section">
                                                <div class="slds-accordion__summary">
                                                    <h3 class="slds-accordion__summary-heading">
                                                        <button class="slds-button slds-button_reset slds-accordion__summary-action" aria-expanded="false" aria-controls="accordion-details-05">
                                                            <svg class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/utility-sprite/svg/symbols.svg#switch")}" />
                                                            </svg>
                                                            <span title="Can I preview the deleted record before restoring it from the recycle bin?" class="slds-truncate">How many objects can be tracked for deletion?</span>
                                                        </button>
                                                    </h3>
                                                    
                                                </div>
                                                <div class="slds-accordion__content" id="accordion-details-05" aria-hidden="true">As of now we are allowing 20 objects to be tracked. Our app will create a new apex trigger on each object to track the delete event.
                                                </div>
                                            </section>
                                        </li>
                                        <li class="slds-accordion__list-item">
                                            <section class="slds-accordion__section">
                                                <div class="slds-accordion__summary">
                                                    <h3 class="slds-accordion__summary-heading">
                                                        <button class="slds-button slds-button_reset slds-accordion__summary-action" aria-expanded="false" aria-controls="accordion-details-05">
                                                            <svg class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/utility-sprite/svg/symbols.svg#switch")}" />
                                                            </svg>
                                                            <span title="Can I preview the deleted record before restoring it from the recycle bin?" class="slds-truncate">I’ve additional questions related to this application, how can I
                                                                contact you?</span>
                                                        </button>
                                                    </h3>
                                                    
                                                </div>
                                                <div class="slds-accordion__content" id="accordion-details-05" aria-hidden="true">You can reach out to us by sending an email to
                                                    <a href="mailto:rbmapp@kandisatech.com">
                                                        rbmapp@kandisatech.com</a>
                                                </div>
                                            </section>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div id="tab-scoped-4" style="padding-bottom:1px" class="slds-tabs_scoped__content slds-hide" role="tabpanel" aria-labelledby="tab-scoped-4__item">
                                <div id="enabletrackingobjnotes" class="slds-box">
                                    <p>
                                        <i>
                                            <b>Note:</b>
                                        </i> Please enable Tracking Object from General Tab.</p>
                                </div>
                                <div id="generalnotesfortracking" class="slds-box">
                                    <p>
                                        <i>
                                            <b>Note:</b>
                                        </i> Please select the objects you would like to track for deletion. When records from these selected objects are deleted, you will receive an email with details of the deleted records.</p>
                                </div><br/>
                                <div id="masterdetailnotes" class="slds-box">
                                    <p>
                                        <i>
                                            <b>Note:</b>
                                        </i> For child records in Master detail relationship, email notifications will not be received when the parent is deleted. Email notifications will only be sent for parent records.</p>
                                </div>
                                
                                <!--<div class="slds-form-element slds-size_1-of-2 slds-max-small-size_1-of-1 slds-hide" id="trackingmethod"> 
                                    <fieldset class="slds-form-element">
                                        <legend class="slds-form-element__legend slds-form-element__label">How would you like to track the deletion : Real Time / Schedule a Batch</legend>
                                        <div class="slds-form-element__control">
                                            <span class="slds-radio">
                                                <input type="radio" id="realtime" value="true" name="default" onchange="changetrackingoption()"/>
                                                <label class="slds-radio__label" for="realtime">
                                                    <span class="slds-radio_faux"></span>
                                                    <span class="slds-form-element__label">Real time object tracking</span>
                                                </label>
                                            </span>
                                            <span class="slds-radio">
                                                <input type="radio" id="schedule" value="true" name="default" onchange="changetrackingoption()" />
                                                <label class="slds-radio__label" for="schedule">
                                                    <span class="slds-radio_faux"></span>
                                                    <span class="slds-form-element__label">Schedule object tracking</span>
                                                </label>
                                            </span>
                                        </div>
                                    </fieldset>
                                </div>-->
                                
                                <div id="trackingobjtable" class="slds-hide">
                                    <table class="slds-table slds-table_bordered slds-max-medium-table_stacked-horizontal slds-m-top_small sldstbodysectionfortracking">
                                        <thead>
                                            <tr class="slds-line-height_reset">
                                                <th class="slds-text-title_caps slds-cell-wrap slds-size_1-of-12" scope="col">
                                                    <div class="slds-truncate" title="Action">Action</div>
                                                </th>
                                                <th class="slds-text-title_caps slds-cell-wrap slds-size_11-of-12" scope="col">
                                                    <div class="slds-truncate" title="Object Name">Object Name</div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbodysectionfortracking">
                                            
                                        </tbody>
                                        <tfoot>
                                            <tr class="slds-line-height_reset">
                                                <td class="slds-text-title_caps slds-cell-wrap" scope="col" colspan="2">
                                                    
                                                    <button class="slds-button slds-button_brand" id="btnAddnewforracking">Add New</button>
                                                    <button class="slds-button slds-button_brand slds-hide btnDisabledtracking" id="btnSavefortacking">Save</button>
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                            <div id="tab-scoped-5" style="padding-bottom:1px" class="slds-tabs_scoped__content slds-hide" role="tabpanel" aria-labelledby="tab-scoped-5__item">
                                <div class="slds-box">
                                    <p>
                                        <i>
                                            <b>Note:</b>
                                        </i> Please select the objects you would like to track for permanently deletion.</p>
                                </div><br/>
                                <div id="trackingobjtable" >
                                    <table class="slds-table slds-table_bordered slds-max-medium-table_stacked-horizontal slds-m-top_small sldstbodysectionfortracking">
                                        <thead>
                                            <tr class="slds-line-height_reset">
                                                <th class="slds-text-title_caps slds-cell-wrap slds-size_1-of-12" scope="col">
                                                    <div class="slds-truncate" title="Action">Action</div>
                                                </th>
                                                <th class="slds-text-title_caps slds-cell-wrap slds-size_11-of-12" scope="col">
                                                    <div class="slds-truncate" title="Object Name">Object Name</div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbodysectionfortracking">
                                            
                                        </tbody>
                                        <tfoot>
                                            <tr class="slds-line-height_reset">
                                                <td class="slds-text-title_caps slds-cell-wrap" scope="col" colspan="2">
                                                    
                                                    <button class="slds-button slds-button_brand" id="btnAddnewforobjtracking">Add New</button>
                                                    <button class="slds-button slds-button_brand slds-hide btnDisabledtracking" id="btnSavefortacking">Save</button>
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                </div>
                
                <!-- SPINNER -->
                <div id="spinner" class="slds-spinner_container slds-hide" style="height:70rem">
                    <div role="status" class="slds-spinner slds-spinner_medium slds-spinner--brand">
                        <div class="slds-spinner__dot-a"></div>
                        <div class="slds-spinner__dot-b"></div>
                    </div>
                </div>
                <!-- / SPINNER -->
                
                
                <div style="margin-top:50px;text-align:center;">
                    App Developed by
                    <a style="text-decoration:underline;" href="http://kandisatech.com/" target="_blank">Kandisa Technologies Private Limited</a>
                </div>
                
            </div>
            
            <script>
            Visualforce.remoting.timeout = 120000; // Set timeout at page level
            
            var gb_options = []; gb_tracking_options = []; gb_records = []; gb_tracking_records = [];
            var gb_general = {};
            var selectedweeks = [];
            
            $(document).ready(function () {
                getSearchObjectSettings();
                fnGeneral();
                
                $('.ldsdatepicker').datepicker({
                    format: 'YYYY-MM-DD',
                    onSelect: function (datepicker, t) {
                        //alert((datepicker.selectedFullDate._d).format('YYYY/MM/DD'));
                        /*var dt = new Date();
                        var cdt = new Date(datepicker.selectedFullDate._d).addDays(15);
                        if (dt > cdt) {*/
                            /*var cdt15 = new Date().addDays(-14);
                            var dverr = $(datepicker.$selectedInput).closest('div.slds-form-element').find('div.clsError');
                            //You cannot select a date prior to 11/06/2018 due to salesforce limitation of storing the data in recycle bin for only 15 days.
                            $(dverr).text('You cannot select a date prior to ' + moment(cdt15).format('MM/DD/YYYY') + ' due to salesforce limitation of storing the data in recycle bin for only 15 days.');
                            //eventDateValue=moment(cdt15).format('DD/MM/YYYY');
                        /*} else {
                            var dverr = $(datepicker.$selectedInput).closest('div.slds-form-element').find('div.clsError');
                            $(dverr).empty();
                        }*/
                        }
                    });
                });
            
            function gettrackingobjects() {
                $('#spinner').removeClass('slds-hide');
                Visualforce.remoting.Manager.invokeAction(
                    //Invoking controller action getcon
                    '{!$RemoteAction.SearchObjectSetting.triggerableobjects}',
                    function(result, event){
                        //We can access the records through the parameter result
                        //event.status determines if there is error or not 
                        if(event.status){
                            if(result){
                                gb_tracking_options = [];
                                for(var i = 0 ; i < result.length ; i++ ) {
                                    var o = {};
                                    o.Name = result[i].name;
                                    o.Key = result[i].value;
                                    gb_tracking_options.push(o);
                                }
                                
                                gb_tracking_options.sort(function (a, b) {
                                    var nameA = a.Name.toUpperCase(); // ignore upper and lowercase
                                    var nameB = b.Name.toUpperCase(); // ignore upper and lowercase
                                    if (nameA < nameB) {
                                        return -1;
                                    }
                                    if (nameA > nameB) {
                                        return 1;
                                    }
                                    
                                    // names must be equal
                                    return 0;
                                });
                            }
                        }
                        $('#spinner').addClass('slds-hide');
                    },
                    {escape: true}
                );    
            }

            function getpermtrackingobjects() {
                //$('#spinner').removeClass('slds-hide');
                Visualforce.remoting.Manager.invokeAction(
                    //Invoking controller action getcon
                    '{!$RemoteAction.SearchObjectSetting.triggerableobjects}',
                    function(result, event){
                        //We can access the records through the parameter result
                        //event.status determines if there is error or not 
                        if(event.status){
                            if(result){
                                gb_tracking_options = [];
                                for(var i = 0 ; i < result.length ; i++ ) {
                                    var o = {};
                                    o.Name = result[i].name;
                                    o.Key = result[i].value;
                                    gb_tracking_options.push(o);
                                }
                                
                                gb_tracking_options.sort(function (a, b) {
                                    var nameA = a.Name.toUpperCase(); // ignore upper and lowercase
                                    var nameB = b.Name.toUpperCase(); // ignore upper and lowercase
                                    if (nameA < nameB) {
                                        return -1;
                                    }
                                    if (nameA > nameB) {
                                        return 1;
                                    }
                                    
                                    // names must be equal
                                    return 0;
                                });
                            }
                        }
                        $('#spinner').addClass('slds-hide');
                    },
                    {escape: true}
                );    
            }
            
            function getSearchObjectSettings() {
                var __sfdcSessionId = '{!GETSESSIONID()}';
                sforce.connection.sessionId = __sfdcSessionId;
                var arrobj = [];
                $.map($('.ddlObject').find('option'), function (obj, key) {
                    arrobj.push(obj.value);
                });
                
                
                $.map($('.ddlObject').find('option'), function (obj, key) {
                    var o = {};
                    o.Name = obj.text;
                    o.Key = obj.value;
                    gb_options.push(o);
                });
                
                gb_options.sort(function (a, b) {
                    var nameA = a.Name.toUpperCase(); // ignore upper and lowercase
                    var nameB = b.Name.toUpperCase(); // ignore upper and lowercase
                    if (nameA < nameB) {
                        return -1;
                    }
                    if (nameA > nameB) {
                        return 1;
                    }
                    
                    // names must be equal
                    return 0;
                });
                
                
                fnGrid();
                fnTrackingGrid();
                
                // var arrObjects = sforce.connection.describeSObjects(arrobj);
                
                // if(arrObjects != undefined && arrObjects.length > 0){
                
                //     $.map($('.ddlObject').find('option'),function(obj,key){
                //         var islayoutable = $.grep(arrObjects, function(v) {
                //             return v.name == obj.value && v.undeletable == 'true';
                //         });
                //         var o = {};
                //         o.Name = obj.text;
                //         o.Key = obj.value; 
                
                //         //if(islayoutable != undefined && islayoutable.length > 0)
                //             gb_options.push(o);
                //     });
                
                //     gb_options.sort(function(a, b) {
                //         var nameA = a.Name.toUpperCase(); // ignore upper and lowercase
                //         var nameB = b.Name.toUpperCase(); // ignore upper and lowercase
                //         if (nameA < nameB) {
                //             return -1;
                //         }
                //         if (nameA > nameB) {
                //             return 1;
                //         }
                
                //         // names must be equal
                //         return 0;
                //     });
                
                //     fnGrid();
                // }
                
                
                /*Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.SearchObjectSetting.getAllObjects}',
                    function(result, event){
                        if (event.status) {
                           $.map(result,function(val, key){
                                var o = {};
                                o.Name = val;
                                o.Key = key;
                                gb_options.push(o);
                            });

                            gb_options.sort(function(a, b) {
                                var nameA = a.Name.toUpperCase(); // ignore upper and lowercase
                                var nameB = b.Name.toUpperCase(); // ignore upper and lowercase
                                if (nameA < nameB) {
                                    return -1;
                                }
                                if (nameA > nameB) {
                                    return 1;
                                }

                                // names must be equal
                                return 0;
                            });
                            // Get DOM IDs for HTML and Visualforce elements like this
                            fnGrid();
                        } else if (event.type === 'exception') {
                            alert(event.message + " " + event.where);
                        } else {
                            alert(event.message);
                        }
                    }, 
                    {escape: true}
                );*/
                };
            
            
            function createremotesite01() {
                var binding = new XMLHttpRequest();
                var request =
                    '<?xml version="1.0" encoding="utf-8"?>' +
                    '<env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">'+
                    '<env:Header>' +
                    '<urn:SessionHeader xmlns:urn="http://soap.sforce.com/2006/04/metadata">' +
                    '<urn:sessionId>{!$Api.Session_ID}</urn:sessionId>' +
                    '</urn:SessionHeader>' +
                    '</env:Header>' +
                    '<env:Body>' +
                    '<createMetadata xmlns="http://soap.sforce.com/2006/04/metadata">' +
                    '<metadata xsi:type="RemoteSiteSetting">' +
                    '<fullName>rbinorgvfinstance</fullName>' +
                    '<description>Metadata API Remote Site Setting for Declarative Recycle Bin.</description>' +
                    '<disableProtocolSecurity>false</disableProtocolSecurity>' +
                    '<isActive>true</isActive>' +
                    '<url>{!remotesiteurl}</url>' +
                    '</metadata>' +
                    '</createMetadata>' +
                    '</env:Body>' +
                    '</env:Envelope>';
                binding.open('POST', '{!Host}');
                binding.setRequestHeader('SOAPAction','""');
                binding.setRequestHeader('Content-Type', 'text/xml');
                binding.onreadystatechange =
                    function() {
                    if(this.readyState==4) {
                        var parser = new DOMParser();
                        var doc  = parser.parseFromString(this.response, 'application/xml');
                        var errors = doc.getElementsByTagName('errors');
                        var messageText = '';
                        for(var errorIdx = 0; errorIdx < errors.length; errorIdx++)
                            messageText+= errors.item(errorIdx).getElementsByTagName('message').item(0).innerHTML + '\n';
                        if(messageText != ''){
                            
                        } else {
                            remotesiteadded = true;
                        }
                    }
                }
                binding.send(request);
            }
            
            function createremotesite02() {
                var binding2 = new XMLHttpRequest();
                var request2 =
                    '<?xml version="1.0" encoding="utf-8"?>' +
                    '<env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">'+
                    '<env:Header>' +
                    '<urn:SessionHeader xmlns:urn="http://soap.sforce.com/2006/04/metadata">' +
                    '<urn:sessionId>{!$Api.Session_ID}</urn:sessionId>' +
                    '</urn:SessionHeader>' +
                    '</env:Header>' +
                    '<env:Body>' +
                    '<createMetadata xmlns="http://soap.sforce.com/2006/04/metadata">' +
                    '<metadata xsi:type="RemoteSiteSetting">' +
                    '<fullName>rbinorginstance</fullName>' +
                    '<description>Metadata API Remote Site Setting for Declarative Recycle Bin.</description>' +
                    '<disableProtocolSecurity>false</disableProtocolSecurity>' +
                    '<isActive>true</isActive>' +
                    '<url>{!orginstance}</url>' +
                    '</metadata>' +
                    '</createMetadata>' +
                    '</env:Body>' +
                    '</env:Envelope>';
                binding2.open('POST', '{!Host}');
                binding2.setRequestHeader('SOAPAction','""');
                binding2.setRequestHeader('Content-Type', 'text/xml');
                binding2.onreadystatechange =
                    function() {
                    if(this.readyState==4) {
                        var parser = new DOMParser();
                        var doc  = parser.parseFromString(this.response, 'application/xml');
                        var errors = doc.getElementsByTagName('errors');
                        var messageText = '';
                        for(var errorIdx = 0; errorIdx < errors.length; errorIdx++)
                            messageText+= errors.item(errorIdx).getElementsByTagName('message').item(0).innerHTML + '\n';
                        if(messageText != ''){
                            
                        } else {
                            remotesiteadded = true;
                        }
                    }
                }
                binding2.send(request2);
            }
            
            function fnTrackingGrid() {
                
                $('#tbodysectionfortracking').empty();
                var strtr = '<tr class="slds-hint-parent" id="{trguid}" data-id="{id}"> \
<td data-label="Action"  class="slds-cell-wrap"> \
<div class="slds-truncate clsdelete" title="Action">{0}</div> \
</td> \
<td data-label="Object Name" class="slds-cell-wrap"> \
<div class="slds-truncate" title="Object Name">{1}</div> \
</td> \
</tr>';
                var deleteicon = '<span id="btnDeletetrackingrec" class="slds-icon_container slds-icon-action-delete slds-icon_container--circle" title="Delete"> \
<svg class="slds-icon slds-icon_x-small" aria-hidden="true"> \
<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/action-sprite/svg/symbols.svg#delete")}" /> \
</svg></span>';
                var ddlselect = '<select data-key="Name" class="slds-select">{option}</select>';
                
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.SearchObjectSetting.findTrackingExistingRecords}',
                    function (result, event) {
                        if (event.status) {
                            gb_tracking_records = result;
                            $.map(gb_tracking_records, function (o) {
                                var tr = strtr;
                                o.recordid = guid();
                                tr = tr.replace('{trguid}', o.recordid);
                                tr = tr.replace('{id}', o.Id);
                                tr = tr.replace('{0}', deleteicon);
                                
                                tr = tr.replace('{1}', o.Name);
                                /*var stroptions = '<option value="">-- Select --</option>';
                                $.map(gb_options,function(option){
                                    var val = option.Name;
                                    if(o.Name == option.Key){
                                        stroptions += '<option selected="true" value="' + option.Key + '">' + val + '</option>';
                                    }else{
                                        stroptions += '<option value="' + option.Key + '">' + val + '</option>';
                                    }
                                    
                                });
                                tr = tr.replace('{1}',ddlselect.replace('{option}',stroptions));*/
                                    
                                    $('#tbodysectionfortracking').append(tr);
                                });
                            } else if (event.type === 'exception') {
                                alert(event.message + " " + event.where);
                            } else {
                                alert(event.message);
                            }
                        },
                        { escape: true }
                    );
                };
            
            function fnGrid() {
                
                $('#tbodysection').empty();
                var strtr = '<tr class="slds-hint-parent" id="{trguid}" data-id="{id}"> \
<td data-label="Action"  class="slds-cell-wrap"> \
<div class="slds-truncate clsdelete" title="Action">{0}</div> \
</td> \
<td data-label="Object Name" class="slds-cell-wrap"> \
<div class="slds-truncate" title="Object Name">{1}</div> \
</td> \
</tr>';
                var deleteicon = '<span id="btnDelete" class="slds-icon_container slds-icon-action-delete slds-icon_container--circle" title="Delete"> \
<svg class="slds-icon slds-icon_x-small" aria-hidden="true"> \
<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/action-sprite/svg/symbols.svg#delete")}" /> \
</svg></span>';
                var ddlselect = '<select data-key="Name" class="slds-select">{option}</select>';
                
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.SearchObjectSetting.findSearchExistingRecords}',
                    function (result, event) {
                        if (event.status) {
                            gb_records = result;
                            $.map(gb_records, function (o) {
                                var tr = strtr;
                                o.recordid = guid();
                                tr = tr.replace('{trguid}', o.recordid);
                                tr = tr.replace('{id}', o.Id);
                                tr = tr.replace('{0}', deleteicon);
                                
                                tr = tr.replace('{1}', o.Name);
                                /*var stroptions = '<option value="">-- Select --</option>';
                                $.map(gb_options,function(option){
                                    var val = option.Name;
                                    if(o.Name == option.Key){
                                        stroptions += '<option selected="true" value="' + option.Key + '">' + val + '</option>';
                                    }else{
                                        stroptions += '<option value="' + option.Key + '">' + val + '</option>';
                                    }
                                    
                                });
                                tr = tr.replace('{1}',ddlselect.replace('{option}',stroptions));*/
                                    
                                    $('#tbodysection').append(tr);
                                });
                            } else if (event.type === 'exception') {
                                alert(event.message + " " + event.where);
                            } else {
                                alert(event.message);
                            }
                        },
                        { escape: true }
                    );
                };
            
            function guid() {
                function s4() {
                    return Math.floor((1 + Math.random()) * 0x10000)
                    .toString(16)
                    .substring(1);
                }
                return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
                    s4() + '-' + s4() + s4() + s4();
            };
            
            $(document).on('click', '#btnAddnew', function () {
                $('#lblmsg').empty();
                $('#lblmsg').addClass('slds-hide');
                
                
                var strtr = '<tr class="slds-hint-parent" id="{trguid}" > \
<td data-label="Action" class="slds-cell-wrap"> \
<div class="slds-truncate" title="Action">{0}</div> \
</td> \
<td data-label="Object Name" class="slds-cell-wrap"> \
<div class="slds-truncate" title="Object Name">{1}</div> \
</td> \
</tr>';
                var deleteicon = '<span id="btnDelete" class="slds-icon_container slds-icon-action-delete slds-icon_container--circle" title="Delete"> \
<svg class="slds-icon slds-icon_x-small" aria-hidden="true"> \
<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/action-sprite/svg/symbols.svg#delete")}" /> \
</svg></span>';
                var ddlselect = '<select data-key="Name" class="slds-select">{option}</select>';
                var tr = strtr;
                var tempid = guid();
                tr = tr.replace('{trguid}', tempid);
                tr = tr.replace('{0}', deleteicon);
                var stroptions = '<option value="" selected="true">-- Select --</option>';
                $.map(gb_options, function (val) {
                    stroptions += '<option value="' + val.Key + '">' + val.Name + '</option>';
                });
                tr = tr.replace('{1}', ddlselect.replace('{option}', stroptions));
                
                
                if (gb_records.length < 20) {
                    $('#btnSave').removeClass('slds-hide');
                    
                    $('#tbodysection').append(tr);
                    var obj = {};
                    obj.recordid = tempid;
                    gb_records.push(obj);
                } else {
                    $('#lblmsg').addClass('slds-theme_info')
                    alert('You cannot add more than 20 entries in the "Default Objects to Search".');
                    
                    $('#lblmsg').removeClass('slds-hide');
                    $('#lblmsg').removeClass('slds-theme_success');
                }
                return false;
            });
            
            $(document).on('click', '#btnAddnewforracking', function () {
                $('#lblmsgfortracking').empty();
                $('#lblmsgfortracking').addClass('slds-hide');
                
                $('#lblmsg').empty();
                $('#lblmsg').addClass('slds-hide');
                
                var strtr = '<tr class="slds-hint-parent" id="{trguid}" > \
<td data-label="Action" class="slds-cell-wrap"> \
<div class="slds-truncate" title="Action">{0}</div> \
</td> \
<td data-label="Object Name" class="slds-cell-wrap"> \
<div class="slds-truncate" title="Object Name">{1}</div> \
</td> \
</tr>';
                var deleteicon = '<span id="btnDeletetrackingrec" class="slds-icon_container slds-icon-action-delete slds-icon_container--circle" title="Delete"> \
<svg class="slds-icon slds-icon_x-small" aria-hidden="true"> \
<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/action-sprite/svg/symbols.svg#delete")}" /> \
</svg></span>';
                var ddlselect = '<select data-key="Name" class="slds-select">{option}</select>';
                var tr = strtr;
                var tempid = guid();
                tr = tr.replace('{trguid}', tempid);
                tr = tr.replace('{0}', deleteicon);
                var stroptions = '<option value="" selected="true">-- Select --</option>';
                $.map(gb_tracking_options, function (val) {
                    stroptions += '<option value="' + val.Key + '">' + val.Name + '</option>';
                });
                tr = tr.replace('{1}', ddlselect.replace('{option}', stroptions));
                
                
                if (gb_tracking_records.length < 20) {
                    $('#btnSavefortacking').removeClass('slds-hide');
                    $('#tbodysectionfortracking').append(tr);
                    var obj = {};
                    obj.recordid = tempid;
                    gb_tracking_records.push(obj);
                } else {
                    $('#lblmsgfortracking').addClass('slds-theme_info')
                    alert('You cannot add more than 20 entries in the "Default Objects to Track".');
                    
                    $('#lblmsgfortracking').removeClass('slds-hide');
                    $('#lblmsgfortracking').removeClass('slds-theme_success');
                    $('#lblmsgfortracking').delay(4000).fadeOut();
                }
                return false;
            });

            $(document).on('click', '#btnAddnewforobjtracking', function () {
                $('#lblmsgfortracking').empty();
                $('#lblmsgfortracking').addClass('slds-hide');
                
                $('#lblmsg').empty();
                $('#lblmsg').addClass('slds-hide');
                
                var strtr = '<tr class="slds-hint-parent" id="{trguid}" > \
<td data-label="Action" class="slds-cell-wrap"> \
<div class="slds-truncate" title="Action">{0}</div> \
</td> \
<td data-label="Object Name" class="slds-cell-wrap"> \
<div class="slds-truncate" title="Object Name">{1}</div> \
</td> \
</tr>';
                var deleteicon = '<span id="btnDeletetrackingrec" class="slds-icon_container slds-icon-action-delete slds-icon_container--circle" title="Delete"> \
<svg class="slds-icon slds-icon_x-small" aria-hidden="true"> \
<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, "/assets/icons/action-sprite/svg/symbols.svg#delete")}" /> \
</svg></span>';
                var ddlselect = '<select data-key="Name" class="slds-select">{option}</select>';
                var tr = strtr;
                var tempid = guid();
                tr = tr.replace('{trguid}', tempid);
                tr = tr.replace('{0}', deleteicon);
                var stroptions = '<option value="" selected="true">-- Select --</option>';
                $.map(gb_tracking_options, function (val) {
                    stroptions += '<option value="' + val.Key + '">' + val.Name + '</option>';
                });
                tr = tr.replace('{1}', ddlselect.replace('{option}', stroptions));
                
                
                if (gb_tracking_records.length < 20) {
                    $('#btnSavefortacking').removeClass('slds-hide');
                    $('#tbodysectionfortracking').append(tr);
                    var obj = {};
                    obj.recordid = tempid;
                    gb_tracking_records.push(obj);
                } else {
                    $('#lblmsgfortracking').addClass('slds-theme_info')
                    alert('You cannot add more than 20 entries in the "Default Objects to Track".');
                    
                    $('#lblmsgfortracking').removeClass('slds-hide');
                    $('#lblmsgfortracking').removeClass('slds-theme_success');
                    $('#lblmsgfortracking').delay(4000).fadeOut();
                }
                return false;
            });
            
            $(document).on('change', '.sldstbodysection select,.sldstbodysection input[type=checkbox]', function () {
                var dkey = $(this).attr('data-key');
                var rid = $(this).closest('tr').attr('id');
                var obj = gb_records.find(x => x.recordid === rid);
                
                if ($(this).attr('type') == 'checkbox') {
                    obj[dkey] = $(this).is(':checked');
                } else {
                    obj[dkey] = $(this).val();
                }
            });
            
            $(document).on('change', '.sldstbodysectionfortracking select,.sldstbodysectionfortracking input[type=checkbox]', function () {
                var dkey = $(this).attr('data-key');
                var rid = $(this).closest('tr').attr('id');
                var obj = gb_tracking_records.find(x => x.recordid === rid);
                
                if ($(this).attr('type') == 'checkbox') {
                    obj[dkey] = $(this).is(':checked');
                } else {
                    obj[dkey] = $(this).val();
                }
            });
            
            $(document).on('click', '#btnSave', function () {
                $('#lblmsg').empty();
                $('#lblmsg').addClass('slds-hide');
                $('#lblmsg').addClass('slds-theme_success');
                $('#lblmsg').removeClass('slds-theme_info');
                
                var lst = [];
                
                $.map(gb_records, function (o) {
                    var obj = {};
                    if (o.Id != undefined)
                        obj.Id = o.Id;
                    
                    obj.Name = o.Name;
                    
                    if (o.Name != null && o.Name != '')
                        lst.push(obj);
                });
                
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.SearchObjectSetting.save}', lst,
                    function (result, event) {
                        if (event.status) {
                            alert('Settings updated successfully.');
                            /*$('#spinner').removeClass('slds-hide');
                            $('#lblmsg').append('Settings updated successfully.');
                            $('#lblmsg').removeClass('slds-hide');
                            $('#btnSave').addClass('slds-hide');
                            
                            $('#lblmsg').delay(4000).fadeOut();*/
                            
                            fnGrid();
                            setTimeout(function () {
                                $('#spinner').addClass('slds-hide');
                            }, 2000);
                        } else if (event.type === 'exception') {
                            alert('Selected object is already available in the default objects list!');
                            
                        } else {
                            alert(event.message);
                        }
                    },
                    { escape: true }
                );
            });
            
            
            $(document).on('click', '#btnSavefortacking', function () {
                $('#spinner').removeClass('slds-hide');
                $(".btnDisabledtracking").attr('disabled', true);
                
                var lst = [];
                $.map(gb_tracking_records, function (o) {
                    var obj = {};
                    if (o.Id != undefined)
                        obj.Id = o.Id;
                    obj.Name = o.Name;
                    
                    if (o.Name != null && o.Name != '')
                        lst.push(obj);
                });
                
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.SearchObjectSetting.savetrackingobjects}', lst,
                    function (result, event) {
                        if (event.status) {
                            alert('Settings updated successfully.');
                            $('#btnSavefortacking').addClass('slds-hide');
                            /*var lblmsg = document.getElementById('lblmsg');
                            lblmsg.innerHTML = 'Settings updated successfully.';
                            lblmsg.style.display = 'block';
                            $('#lblmsg').delay(4000).fadeOut();*/
                            fnTrackingGrid();
                        } else if (event.type === 'exception') {
                            setTimeout(function () {
                                $('#spinner').addClass('slds-hide');
                            }, 2000);
                            alert('Selected object is already available in the default tracking objects list!');
                            
                        } else {
                            alert(event.message);
                        }
                        $(".btnDisabledtracking").attr('disabled', false);
                        $('#spinner').addClass('slds-hide');
                    },
                    { escape: true }
                );                
            });
            
            
            $(document).on('click', '#btnDeletetrackingrec', function () {
                
                var rid = $(this).closest('tr').attr('id');
                
                var tmpobj = gb_tracking_records.find(x => x.recordid === rid);
                
                var obj = {};
                obj.Id = tmpobj.Id;
                obj.Name = tmpobj.Name;
                var objthis = $(this);
                
                if (confirm('Are you sure to delete this record?')) {
                    $('#spinner').removeClass('slds-hide');
                    if (tmpobj.Id != undefined) {
                        Visualforce.remoting.Manager.invokeAction(
                            '{!$RemoteAction.SearchObjectSetting.fnDeleteTrackingObject}', obj,
                            function (result, event) {
                                if (event.status) {
                                    alert('Settings updated successfully.');
                                    /*var lblmsg = document.getElementById('lblmsg');
                                    lblmsg.innerHTML = 'Settings updated successfully.';
                                    lblmsg.style.display = 'block';
                                    $('#lblmsg').delay(4000).fadeOut();*/
                                    fnTrackingGrid();
                                    $('#spinner').addClass('slds-hide');
                                } else {
                                    alert(event.message);
                                }
                            },
                            { escape: true }
                        );
                    } else {
                        gb_tracking_records = gb_tracking_records.filter(function (obj) {
                            return obj.recordid !== rid;
                        });
                        
                        $(objthis).closest('tr').remove();
                        
                        $('#spinner').addClass('slds-hide');
                    }
                }
            });
            
            $(document).on('click', '#btnDelete', function () {
                $('#lblmsg').empty();
                $('#lblmsg').addClass('slds-hide');
                $('#lblmsg').addClass('slds-theme_success');
                $('#lblmsg').removeClass('slds-theme_info');
                
                
                var rid = $(this).closest('tr').attr('id');
                var tmpobj = gb_records.find(x => x.recordid === rid);
                
                var obj = {};
                obj.Id = tmpobj.Id;
                
                var objthis = $(this);
                
                if (confirm('Are you sure to delete this record?')) {
                    if (tmpobj.Id != undefined) {
                        Visualforce.remoting.Manager.invokeAction(
                            '{!$RemoteAction.SearchObjectSetting.fnDelete}', obj,
                            function (result, event) {
                                if (event.status) {
                                    alert('Settings updated successfully.');
                                    /*$('#spinner').removeClass('slds-hide');
                                    $('#lblmsg').append('Settings updated successfully.');
                                    $('#lblmsg').removeClass('slds-hide');
                                    
                                    $('#lblmsg').delay(4000).fadeOut();*/
                                    
                                    fnGrid();
                                    setTimeout(function () { $('#spinner').addClass('slds-hide'); }, 2000);
                                } else {
                                    alert(event.message);
                                }
                            },
                            { escape: true }
                        );
                    } else {
                        gb_records = gb_records.filter(function (obj) {
                            return obj.recordid !== rid;
                        });
                        
                        $(objthis).closest('tr').remove();
                    }
                }
            });
            
            //tab show hide
            $(document).on('click', '.slds-tabs_scoped__link', function () {
                var oldActiveTab = $('ul').find('li.slds-is-active').find('a').attr('aria-controls');
                $('ul').find('li.slds-is-active').removeClass('slds-is-active');
                var tabId = $(this).attr('aria-controls');
                var LI = $(this).closest('li').addClass('slds-is-active');
                $('#' + oldActiveTab).removeClass('slds-show').addClass('slds-hide');
                $('#' + tabId).removeClass('slds-hide').addClass('slds-show');
            });
            
            function fnGeneral() {
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.SearchObjectSetting.fnGeneral}',
                    function (result, event) {
                        if (event.status) {
                            gb_general = result;
                            if (gb_general.rbin__Search_Inactive_Users_in_Deleted_By__c != undefined) {
                                if (gb_general.rbin__Search_Inactive_Users_in_Deleted_By__c == true) {
                                    $('#checkbox-27').attr('checked', 'checked');
                                } 
                            }
                            if(gb_general.rbin__Send_record_deletion_email_to__c != ''){
                                $('#emailtext').attr('value', gb_general.rbin__Send_record_deletion_email_to__c);
                            }
                            /*if (gb_general.rbin__Start__c != ''){
                                $("input[id$='ipFromDate']").val(gb_general.rbin__Start__c);
                            }
                            if(gb_general.rbin__End__c != ''){
                                $("input[id$='ipToDate']").val(gb_general.rbin__End__c);
                            }*/
                            
                            if(gb_general.rbin__Real_time_object_tracking__c == true) {
                                $('#objtrackingchk').attr('checked', 'checked');
                                $('#trackingobjtable').removeClass('slds-hide');
                                $('#trackingmethod').removeClass('slds-hide');
                                $('#trackingschedule').removeClass('slds-hide');
                                $('#enabletrackingobjnotes').addClass('slds-hide');
                                $('#masterdetailnotes').removeClass('slds-hide');
                                $('#generalnotesfortracking').removeClass('slds-hide');
                            } else {
                                $('#trackingobjtable').addClass('slds-hide');
                                $('#trackingschedule').addClass('slds-hide');
                                $('#enabletrackingobjnotes').removeClass('slds-hide');
                                $('#masterdetailnotes').addClass('slds-hide');
                                $('#generalnotesfortracking').addClass('slds-hide');
                            } 
                            if(gb_general.rbin__Real_time_object_tracking__c) {
                                $('#realtime').attr('checked', 'checked');
                            }
                            if(gb_general.rbin__Schedule_object_tracking__c) {
                                $('#schedule').attr('checked', 'checked');
                                $('#schedulebatch').removeClass('slds-hide');
                                
                                if(gb_general.rbin__isDaily__c) {
                                    $('#dailytrack').attr('checked', 'checked');
                                }
                                
                                if(gb_general.rbin__isWeekly__c) {
                                    $('#weeklytrack').attr('checked', 'checked');
                                    $('#selectweek').removeClass('slds-hide');
                                    
                                    if(gb_general.rbin__SelectedWeek__c != ''){
                                        var nameArr = gb_general.rbin__SelectedWeek__c.split(',');
                                        selectedweeks = gb_general.rbin__SelectedWeek__c.split(',');
                                        for(var i = 0 ; i < nameArr.length ; i++) {
                                            $("#"+nameArr[i]).prop("checked", true); 
                                        }
                                    }
                                }
                                
                                if(gb_general.rbin__Preferred_Start_Time__c != ''){
                                    $("select[id$='preferredtime']").val(gb_general.rbin__Preferred_Start_Time__c.toString());
                                }
                            }
                        } else if (event.type === 'exception') {
                            alert(event.message + " " + event.where);
                        } else {
                            alert(event.message);
                        }
                    },
                    { escape: true }
                );
            };
            
            function changetrackingoption() {
                if ($("input[id='schedule']:checked").val()) {
                    $('#schedulebatch').removeClass('slds-hide');
                    $('#masterdetailnotes').addClass('slds-hide');
                    if(!gb_general.rbin__isDaily__c && !gb_general.rbin__isWeekly__c){
                        $('#dailytrack').attr('checked', 'checked');
                    } else if (gb_general.rbin__isDaily__c && !gb_general.rbin__isWeekly__c) {
                        $('#dailytrack').attr('checked', 'checked');
                    }
                } else {
                    $('#schedulebatch').addClass('slds-hide');
                    $('#masterdetailnotes').removeClass('slds-hide');
                }
            };
            
            function selectweekfortracking() {
                if ($("input[id='weeklytrack']:checked").val()) {
                    $('#selectweek').removeClass('slds-hide');
                } else {
                    $('#selectweek').addClass('slds-hide');
                }
            };
            
            function enableDisable(sel)
            {
                if(selectedweeks.includes(sel.toString())){
                    var newsel = [];
                    selectedweeks.forEach(s => {
                        if(s != sel){ 
                        newsel.push(s);
                    }
                                          });   
                    selectedweeks = newsel;
                } else {
                    selectedweeks.push(sel.toString());    
                }
            };
            
            /*$('#btnSaveGeneral').on('click', function(e){
                var lblmsg = document.getElementById('lblmsg');
                lblmsg.innerHTML = 'Record save successfully.';
                lblmsg.style.display = 'block';
                $('#lblmsg').delay(4000).fadeOut();
            });*/
            
            $('#btnSaveGeneral').on('click', function(e){
                e.preventDefault();
                $(".btnDisabled").attr('disabled', true);
                $('#spinner').removeClass('slds-hide');
                var validate = true;
                /*$('#lblmsg').empty();
                $('#spinner').removeClass('slds-hide');
                $('#lblmsg').addClass('slds-hide');
                $('#lblmsg').addClass('slds-theme_success');
                $('#lblmsg').removeClass('slds-theme_info');*/
                
                if ($('#checkbox-27').is(':checked')) {
                    gb_general.rbin__Search_Inactive_Users_in_Deleted_By__c = true;
                } else {
                    gb_general.rbin__Search_Inactive_Users_in_Deleted_By__c = false;
                }
                
                if ($('#objtrackingchk').is(':checked')) {
                    $('#trackingobjtable').removeClass('slds-hide');
                    $('#trackingmethod').removeClass('slds-hide');
                    $('#trackingschedule').removeClass('slds-hide');
                    $('#enabletrackingobjnotes').addClass('slds-hide');
                    $('#masterdetailnotes').removeClass('slds-hide');
                    $('#generalnotesfortracking').removeClass('slds-hide');
                    
                    gb_general.rbin__Real_time_object_tracking__c = true;
                } else {
                    $('#trackingobjtable').addClass('slds-hide');
                    $('#enabletrackingobjnotes').removeClass('slds-hide');
                    $('#masterdetailnotes').addClass('slds-hide');
                    $('#generalnotesfortracking').addClass('slds-hide');
                    gb_general.rbin__Real_time_object_tracking__c = false;
                }
                
                /*if ($("input[id='realtime']:checked").val()) {
                    gb_general.rbin__Real_time_object_tracking__c = true;
                    $('#masterdetailnotes').removeClass('slds-hide');
                } else {
                    gb_general.rbin__Real_time_object_tracking__c = false;
                    $('#masterdetailnotes').addClass('slds-hide');
                }*/
                
                if ($("input[id='schedule']:checked").val()) {
                    gb_general.rbin__Schedule_object_tracking__c = true;
                } else {
                    gb_general.rbin__Schedule_object_tracking__c = false;
                }
                
                if ($("input[id='dailytrack']:checked").val()) {
                    gb_general.rbin__isDaily__c = true;
                } else {
                    gb_general.rbin__isDaily__c = false;
                }
                
                if ($("input[id='weeklytrack']:checked").val()) {
                    if(selectedweeks.length != 0){
                        gb_general.rbin__SelectedWeek__c = selectedweeks.toString();
                    } else {
                        alert('atleast "Recurs every week on" is required.');    
                        validate = false;
                    }
                    gb_general.rbin__isWeekly__c = true;
                } else {
                    gb_general.rbin__isWeekly__c = false;
                }
                /*if($('#ipFromDate').val() != '') {
                    gb_general.rbin__Start__c = $("input[id$='ipFromDate']").val();
                } else {
                    alert('"Start" Date is required.');
                    validate = false;
                }
                
                if($('#ipToDate').val() != '') {
                    gb_general.rbin__End__c = $("input[id$='ipToDate']").val();
                } else {
                    alert('"End" Date is required.');
                    validate = false;
                }*/
                
                if($("select[id$='preferredtime']").val() != ''){
                    gb_general.rbin__Preferred_Start_Time__c = $("select[id$='preferredtime']").val();   
                }else {
                    alert('"Preferred Start Time" is required.');
                    validate = false;
                }
                if($('#emailtext').val() == '')
                {
                    validate = false;
                    alert('"Send record deletion email to" field is required.');
                } else {
                    var pattern = /^[a-zA-Z0-9\-_]+(\.[a-zA-Z0-9\-_]+)*@[a-z0-9]+(\-[a-z0-9]+)*(\.[a-z0-9]+(\-[a-z0-9]+)*)*\.[a-z]{2,4}$/;
                    if($('#emailtext').val().includes(',')) {
                        var emailids = $('#emailtext').val().split(',');
                        var chkduplicate = [];
                        for(var i = 0 ; i < emailids.length ; i++){
                            if(pattern.test(emailids[i])){
                                if(chkduplicate.includes(emailids[i])){
                                    alert(emailids[i] + ' is alreay added.');
                                    validate = false;
                                } else {
                                    validate = true;
                                    chkduplicate.push(emailids[i]);
                                }
                            } else {
                                validate = false;
                                alert('Invalid Email Id : ' + emailids[i]);
                            }   
                        }
                        gb_general.rbin__Send_record_deletion_email_to__c = $('#emailtext').val();
                    } else {
                        var mail = $('#emailtext').val();
                        if(pattern.test(mail)){
                            gb_general.rbin__Send_record_deletion_email_to__c = $('#emailtext').val();
                            validate = true;
                        } else {
                            validate = false;
                            alert('Invalid Email Id : ' + $('#emailtext').val());
                        }
                    }
                }
                if(validate == true && gb_general.rbin__IsRemoteSiteAdded__c == false){
                    createremotesite01();
                    createremotesite02(); 
                    gb_general.rbin__IsRemoteSiteAdded__c = true;
                }
                if(validate == true){
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.SearchObjectSetting.fnSaveGeneral}', gb_general,
                        function (result, event) {
                            if (event.status) {
                                alert('Record save successfully.');
                            } else if (event.type === 'exception') {
                                alert(event.message + " " + event.where);
                            } else {
                                alert(event.message);
                            }
                            $(".btnDisabled").attr('disabled', false);
                            $('#spinner').addClass('slds-hide');
                        },
                        { escape: true }
                    );
                } else {
                    $(".btnDisabled").attr('disabled', false);
                    $('#spinner').addClass('slds-hide');
                }
            });
            
            function IsEmail(email) {
                var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                if(!regex.test(email)) {
                    return false;
                }else{
                    return true;
                }
            };
            
            $(document).on('click', 'section.slds-accordion__section', function () {
                $('ul.slds-accordion').find('section.slds-accordion__section').removeClass('slds-is-open');
                $('button[aria-controls*=accordion-details-]').attr('aria-expanded', 'false');
                
                $(this).addClass('slds-is-open');
                $(this).find('button[aria-controls*=accordion-details-]').attr('aria-expanded', 'true');
            });
            </script>
        </body>
        
        
    </html>
</apex:component>